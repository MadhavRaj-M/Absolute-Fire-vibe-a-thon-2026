<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulsePath: Production Build</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- GLOBAL THEME --- */
        :root { --primary: #2563eb; --alert: #ef4444; --success: #22c55e; --bg: #020617; }
        body { background-color: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* --- MAP STYLES --- */
        #map { width: 100vw; height: 100vh; z-index: 1; filter: contrast(1.1) brightness(0.9); }
        
        /* --- MOBILE APP SIMULATION (User View) --- */
        .mobile-frame {
            width: 380px; height: 750px;
            background: #0f172a;
            border: 8px solid #334155;
            border-radius: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
        }
        .notch {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 120px; height: 25px;
            background: #334155;
            border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;
            z-index: 50;
        }
        
        /* --- GLASSMOPHISM DASHBOARD (Admin View) --- */
        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        /* --- MARKER STYLES --- */
        .signal-box {
            width: 14px; height: 14px;
            border-radius: 50%;
            background: #ef4444;
            border: 2px solid white;
            box-shadow: 0 0 8px #ef4444;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .signal-green {
            background: #22c55e !important;
            box-shadow: 0 0 20px #22c55e, 0 0 40px #22c55e !important;
            transform: scale(1.6);
            border-color: #bef264;
            z-index: 1000;
        }
        
        .vehicle-marker {
            transition: transform 0.1s linear;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5));
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .scanline { position: fixed; top: 0; left: 0; w: 100%; h: 100%; background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.2) 51%); background-size: 100% 4px; pointer-events: none; z-index: 99; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Steps Animation */
        .step-line { position: absolute; left: 7px; top: 20px; bottom: -10px; width: 2px; background: #334155; }
        .step-item.active .step-dot { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .step-item.active .step-text { color: white; }
    </style>
</head>
<body>

    <div class="fixed top-6 left-1/2 -translate-x-1/2 z-[100] flex gap-1 bg-gray-900/90 p-1.5 rounded-full border border-gray-700 shadow-xl">
        <button onclick="switchView('user')" id="btn-user" class="px-5 py-2 text-xs font-bold rounded-full bg-blue-600 text-white transition-all">USER APP</button>
        <button onclick="switchView('admin')" id="btn-admin" class="px-5 py-2 text-xs font-bold rounded-full text-gray-400 hover:text-white transition-all">COMMAND MAP</button>
    </div>

    <div id="view-user" class="w-full h-screen flex items-center justify-center relative bg-slate-900">
        <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-blue-900 via-slate-900 to-black"></div>

        <div class="mobile-frame">
            <div class="notch"></div>
            
            <div class="p-6 pt-12 bg-gradient-to-b from-slate-900 to-slate-900/0">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-red-600 rounded-lg flex items-center justify-center shadow-lg shadow-red-900/50">
                            <i data-lucide="zap" class="text-white w-5 h-5"></i>
                        </div>
                        <span class="font-bold text-lg tracking-tight">PulsePath</span>
                    </div>
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                </div>
                <h2 class="text-2xl font-bold leading-tight">Emergency<br>Reporting</h2>
            </div>

            <div class="flex-1 p-6 overflow-y-auto">
                
                <div id="user-form" class="space-y-4">
                    <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                        <label class="text-[10px] text-gray-400 font-bold tracking-widest uppercase mb-2 block">Incident Type</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="selectType(this, 'MED')" class="type-btn active bg-blue-600/20 border border-blue-500 text-blue-400 py-3 rounded-lg flex flex-col items-center gap-1 hover:bg-blue-600/30 transition">
                                <i data-lucide="ambulance" class="w-5 h-5"></i>
                                <span class="text-[9px] font-bold">MEDICAL</span>
                            </button>
                            <button onclick="selectType(this, 'FIRE')" class="type-btn bg-slate-800 border border-slate-700 text-gray-400 py-3 rounded-lg flex flex-col items-center gap-1 hover:border-red-500 hover:text-red-400 transition">
                                <i data-lucide="flame" class="w-5 h-5"></i>
                                <span class="text-[9px] font-bold">FIRE</span>
                            </button>
                            <button onclick="selectType(this, 'CRASH')" class="type-btn bg-slate-800 border border-slate-700 text-gray-400 py-3 rounded-lg flex flex-col items-center gap-1 hover:border-orange-500 hover:text-orange-400 transition">
                                <i data-lucide="car" class="w-5 h-5"></i>
                                <span class="text-[9px] font-bold">CRASH</span>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-400 font-bold tracking-widest uppercase">Description</label>
                        <textarea id="incident-desc" class="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:outline-none focus:border-blue-500 h-24 resize-none" placeholder="Describe the situation..."></textarea>
                    </div>

                    <div class="space-y-2">
                        <label class="text-[10px] text-gray-400 font-bold tracking-widest uppercase">Location</label>
                        <select id="incident-loc" class="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-sm focus:outline-none">
                            <option value="Anna Nagar">üìç Anna Nagar Roundtana</option>
                            <option value="Guindy">üìç Guindy Kathipara</option>
                            <option value="T Nagar">üìç T Nagar Bus Stand</option>
                        </select>
                    </div>

                    <button onclick="submitEmergency()" class="w-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 text-white font-bold py-4 rounded-xl shadow-lg shadow-red-900/40 transform active:scale-95 transition-all flex items-center justify-center gap-2">
                        <span>REQUEST HELP</span>
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </button>
                </div>

                <div id="ai-screen" class="hidden h-full flex flex-col items-center justify-center text-center -mt-10">
                    <div class="relative w-24 h-24 mb-6">
                        <div class="absolute inset-0 border-4 border-slate-700 rounded-full"></div>
                        <div class="absolute inset-0 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                        <i data-lucide="brain-circuit" class="absolute inset-0 m-auto text-blue-400 w-8 h-8 animate-pulse"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Analyzing Request</h3>
                    <div id="ai-log" class="text-xs text-gray-400 font-mono">Connecting to Neural Grid...</div>
                </div>

                <div id="tracker-screen" class="hidden">
                    <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 mb-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-bold text-white">Help is on the way</h3>
                                <p class="text-xs text-gray-400 mt-1">ETA: <span id="user-eta" class="text-blue-400 font-mono font-bold text-base">CALC...</span></p>
                            </div>
                            <div class="bg-blue-600/20 text-blue-400 p-2 rounded-lg">
                                <i data-lucide="siren" class="w-6 h-6 animate-pulse"></i>
                            </div>
                        </div>
                    </div>

                    <div class="pl-2 space-y-6 relative">
                        <div class="step-line"></div>
                        
                        <div class="step-item active relative pl-6">
                            <div class="step-dot absolute left-0 top-1 w-4 h-4 rounded-full bg-green-500 border-2 border-slate-900 shadow-[0_0_10px_#22c55e]"></div>
                            <h4 class="text-sm font-bold text-white step-text">Request Verified</h4>
                            <p class="text-[10px] text-gray-500">AI Priority: High</p>
                        </div>

                        <div id="track-dispatch" class="step-item relative pl-6">
                            <div class="step-dot absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-700 border-2 border-slate-900 transition-colors duration-500"></div>
                            <h4 class="text-sm font-bold text-gray-500 step-text transition-colors duration-500">Unit Dispatched</h4>
                            <p class="text-[10px] text-gray-500">Nearest unit assigned</p>
                        </div>

                        <div id="track-route" class="step-item relative pl-6">
                            <div class="step-dot absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-700 border-2 border-slate-900 transition-colors duration-500"></div>
                            <h4 class="text-sm font-bold text-gray-500 step-text transition-colors duration-500">En Route</h4>
                            <p class="text-[10px] text-gray-500">Clearing traffic signals...</p>
                        </div>

                        <div id="track-arrive" class="step-item relative pl-6">
                            <div class="step-dot absolute left-0 top-1 w-4 h-4 rounded-full bg-slate-700 border-2 border-slate-900 transition-colors duration-500"></div>
                            <h4 class="text-sm font-bold text-gray-500 step-text transition-colors duration-500">Arrived</h4>
                            <p class="text-[10px] text-gray-500">Unit at location</p>
                        </div>
                    </div>
                </div>

            </div>
            
            <div class="h-16 bg-slate-900 border-t border-slate-800 flex justify-around items-center px-4">
                <i data-lucide="home" class="text-blue-500 w-6 h-6"></i>
                <i data-lucide="activity" class="text-gray-600 w-6 h-6"></i>
                <i data-lucide="user" class="text-gray-600 w-6 h-6"></i>
            </div>
        </div>
    </div>

    <div id="view-admin" class="hidden w-full h-screen relative">
        <div class="scanline"></div>
        <div id="map"></div>

        <div class="absolute top-8 left-8 z-50 pointer-events-none">
            <h1 class="text-3xl font-bold text-white tracking-widest drop-shadow-md flex items-center gap-4">
                <div class="w-3 h-3 bg-red-600 rounded-sm animate-ping"></div>
                CHENNAI<span class="text-blue-500">_GRID_V2</span>
            </h1>
            <div class="flex items-center gap-4 mt-2 pl-7">
                <div class="text-[10px] bg-blue-900/50 border border-blue-500 text-blue-300 px-2 py-1 rounded font-mono">SATELLITE: ONLINE</div>
                <div class="text-[10px] bg-green-900/50 border border-green-500 text-green-300 px-2 py-1 rounded font-mono">TRAFFIC AI: ACTIVE</div>
            </div>
        </div>

        <div class="absolute top-6 right-6 z-50 w-[380px] glass-panel p-5 rounded-2xl flex flex-col max-h-[90vh]">
            <div class="mb-4 pb-4 border-b border-white/10">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">Live Feed</h3>
                <div id="admin-status" class="text-sm font-mono text-gray-300">SYSTEM IDLE // MONITORING...</div>
            </div>

            <div class="mb-4">
                <h3 class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2">Signal Matrix</h3>
                <div id="signal-list" class="grid grid-cols-4 gap-2">
                    </div>
            </div>

            <div class="flex-1 overflow-y-auto space-y-2 pr-1 custom-scroll" id="fleet-list">
                </div>
            
            <button onclick="resetSystem()" class="mt-4 w-full py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-xs font-bold text-gray-400 transition">
                RESET SIMULATION
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <script>
        // --- 1. DATA CONFIGURATION ---
        const LOCATIONS = {
            "Anna Nagar": [13.0850, 80.2100],
            "Guindy": [13.0067, 80.2206],
            "T Nagar": [13.0400, 80.2300]
        };

        const HOSPITALS = [
            { name: "Apollo Main", pos: [13.0630, 80.2550] },
            { name: "Stanley Govt", pos: [13.1075, 80.2875] },
            { name: "MIOT Int.", pos: [13.0180, 80.1900] }
        ];

        const FIRE_STATIONS = [
            { name: "FS Guindy", pos: [13.0100, 80.2200] },
            { name: "FS Anna Nagar", pos: [13.0850, 80.2100] }
        ];

        // REAL SIGNALS along major routes
        const SIGNALS = [
            { id: "S1", pos: [13.0067, 80.2206] }, // Kathipara
            { id: "S2", pos: [13.0300, 80.2350] }, // Nandanam
            { id: "S3", pos: [13.0600, 80.2500] }, // Spencer
            { id: "S4", pos: [13.0850, 80.2100] }, // Anna Arch
            { id: "S5", pos: [13.0850, 80.1950] }, // Thirumangalam
            { id: "S6", pos: [13.0400, 80.2300] }  // T Nagar
        ];

        // --- STATE ---
        let map, fleet = [], signalMarkers = [], activeIncident = null, activePolylines = [];
        let selectedType = 'MED';

        // --- INIT ---
        function init() {
            lucide.createIcons();
            
            // Map Setup
            map = L.map('map', { zoomControl: false }).setView([13.0600, 80.2200], 12);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri', maxZoom: 19
            }).addTo(map);
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}').addTo(map);

            // Spawn Assets
            setupAssets();
            updateAdminUI();
        }

        function setupAssets() {
            // Signals
            const sigContainer = document.getElementById('signal-list');
            SIGNALS.forEach((s, i) => {
                const el = document.createElement('div');
                el.className = 'signal-box';
                el.id = `map-sig-${i}`;
                const m = L.marker(s.pos, { icon: L.divIcon({ className: 'none', html: el, iconSize: [14,14] }) }).addTo(map);
                signalMarkers.push({ ...s, marker: m, status: 'RED', el_id: `map-sig-${i}`, ui_id: `ui-sig-${i}` });

                // UI Dot
                const dot = document.createElement('div');
                dot.id = `ui-sig-${i}`;
                dot.className = 'h-1.5 rounded-full bg-red-900 transition-colors duration-300';
                sigContainer.appendChild(dot);
            });

            // Hospitals & Ambulances
            HOSPITALS.forEach((h, i) => {
                L.marker(h.pos, {icon: L.divIcon({ html: `<div class="bg-blue-900/80 text-blue-200 text-[9px] px-2 py-0.5 rounded border border-blue-500/50">üè• ${h.name}</div>`, className: 'none', iconSize: [100, 20] }) }).addTo(map);
                fleet.push(createUnit(`AMB-${i+1}`, 'MED', 'üöë', '#3b82f6', h.pos));
            });

            // Fire Stn & Trucks
            FIRE_STATIONS.forEach((f, i) => {
                L.marker(f.pos, {icon: L.divIcon({ html: `<div class="bg-red-900/80 text-red-200 text-[9px] px-2 py-0.5 rounded border border-red-500/50">üöí ${f.name}</div>`, className: 'none', iconSize: [100, 20] }) }).addTo(map);
                fleet.push(createUnit(`FIRE-${i+1}`, 'FIRE', 'üöí', '#ef4444', f.pos));
            });
        }

        function createUnit(id, type, icon, color, pos) {
            const m = L.marker(pos, { icon: L.divIcon({ html: `<div class="text-xl filter drop-shadow-lg transition-transform duration-300" style="transform: rotate(0deg)">${icon}</div>`, className: 'none', iconSize: [24,24] }) }).addTo(map);
            return { id, type, icon, color, pos, basePos: pos, status: 'IDLE', marker: m, speed: 0 };
        }

        // --- USER APP LOGIC ---
        function selectType(btn, type) {
            document.querySelectorAll('.type-btn').forEach(b => {
                b.classList.remove('active', 'bg-blue-600/20', 'border-blue-500', 'text-blue-400');
                b.classList.add('bg-slate-800', 'border-slate-700', 'text-gray-400');
            });
            btn.classList.remove('bg-slate-800', 'border-slate-700', 'text-gray-400');
            btn.classList.add('active', 'bg-blue-600/20', 'border-blue-500', 'text-blue-400');
            selectedType = type;
        }

        function submitEmergency() {
            const locName = document.getElementById('incident-loc').value;
            const desc = document.getElementById('incident-desc').value;
            if(!desc) return alert("Please describe the emergency");

            // 1. Show AI Screen
            document.getElementById('user-form').classList.add('hidden');
            document.getElementById('ai-screen').classList.remove('hidden');

            // 2. Simulate Processing
            const log = document.getElementById('ai-log');
            setTimeout(() => log.innerText = "Analyzing keywords...", 800);
            setTimeout(() => log.innerText = `Detected Location: ${locName}`, 1600);
            setTimeout(() => log.innerText = "Dispatching Nearest Unit...", 2400);

            setTimeout(() => {
                // 3. Switch to Map & Dispatch
                document.getElementById('ai-screen').classList.add('hidden');
                document.getElementById('tracker-screen').classList.remove('hidden');
                switchView('admin'); // Force user to see map action
                
                spawnIncident(locName, selectedType);
            }, 3000);
        }

        // --- COMMAND LOGIC ---
        function spawnIncident(locName, type) {
            const latlng = LOCATIONS[locName];
            
            // Incident Marker
            const emoji = type === 'FIRE' ? 'üî•' : 'üí•';
            activeIncident = L.marker(latlng, { icon: L.divIcon({ html: `<div class="text-5xl animate-bounce drop-shadow-[0_0_20px_rgba(239,68,68,1)]">${emoji}</div>`, className: 'none', iconSize: [50,50] }) }).addTo(map);
            
            // Find Nearest
            const unit = findNearest(latlng, type === 'FIRE' ? 'FIRE' : 'MED');
            
            if(unit) {
                document.getElementById('admin-status').innerHTML = `<span class="text-red-500 animate-pulse">ALERT: ${type} at ${locName}</span><br>Dispatching ${unit.id}`;
                updateStep('track-dispatch', true);
                
                // START MISSION
                runMission(unit, latlng);
            }
        }

        async function runMission(unit, target) {
            unit.status = "RESPONDING";
            updateAdminUI();
            
            // Drive
            updateStep('track-route', true);
            await drive(unit, unit.pos, target);
            
            // Arrived
            unit.status = "ON SCENE";
            unit.speed = 0;
            updateAdminUI();
            updateStep('track-arrive', true);
            document.getElementById('user-eta').innerText = "ARRIVED";
            document.getElementById('user-eta').classList.replace('text-blue-400', 'text-green-500');
        }

        // --- PHYSICS & ROUTING (The "Green Wave") ---
        async function drive(unit, start, end) {
            const url = `https://router.project-osrm.org/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                const path = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]); // Leaflet LatLng

                // Draw Path Line
                const poly = L.polyline(path, { color: unit.color, weight: 4, dashArray: '10, 10', opacity: 0.8 }).addTo(map);
                activePolylines.push(poly);

                return new Promise(resolve => {
                    let i = 0;
                    const timer = setInterval(() => {
                        if(i >= path.length) { clearInterval(timer); resolve(); return; }
                        
                        const pos = path[i];
                        unit.marker.setLatLng(pos);
                        unit.pos = pos;
                        
                        // Fake Speed & ETA
                        unit.speed = Math.floor(50 + Math.random() * 20);
                        const eta = Math.floor((path.length - i) / 5);
                        if(i % 10 === 0) {
                            document.getElementById('user-eta').innerText = `${eta}s`;
                            // Rotate Marker (Basic)
                            if(i < path.length - 1) {
                                const next = path[i+1];
                                const angle = Math.atan2(next[0] - pos[0], next[1] - pos[1]) * 180 / Math.PI;
                                // unit.marker.getElement().firstChild.style.transform = `rotate(${angle}deg)`;
                            }
                        }

                        // ** GREEN WAVE CHECK **
                        checkSignals(pos);

                        i++;
                    }, 40); // 40ms update
                });
            } catch(e) { console.error(e); }
        }

        function checkSignals(pos) {
            signalMarkers.forEach(s => {
                const dist = map.distance(pos, s.pos);
                const box = document.getElementById(s.el_id); // Map Marker
                const ui = document.getElementById(s.ui_id);  // Dashboard Dot

                if (dist < 400) { // Approaching
                    if(s.status === 'RED') {
                        s.status = 'GREEN';
                        box.classList.add('signal-green');
                        ui.classList.replace('bg-red-900', 'bg-green-500');
                        ui.classList.add('shadow-[0_0_10px_#22c55e]');
                    }
                } else if (dist > 500 && s.status === 'GREEN') { // Passed
                    s.status = 'RED';
                    box.classList.remove('signal-green');
                    ui.classList.replace('bg-green-500', 'bg-red-900');
                    ui.classList.remove('shadow-[0_0_10px_#22c55e]');
                }
            });
        }

        // --- UTILS ---
        function findNearest(loc, type) {
            let best = null, minDist = Infinity;
            fleet.forEach(u => {
                if(u.type === type && u.status === 'IDLE') {
                    const d = map.distance(loc, u.pos);
                    if(d < minDist) { minDist = d; best = u; }
                }
            });
            return best;
        }

        function updateAdminUI() {
            const list = document.getElementById('fleet-list');
            list.innerHTML = '';
            fleet.sort((a,b) => (a.status === 'IDLE' ? 1 : -1)).forEach(u => {
                const active = u.status !== 'IDLE';
                list.innerHTML += `
                    <div class="p-3 rounded-lg mb-2 border ${active ? `bg-${u.color === '#3b82f6' ? 'blue' : 'red'}-900/30 border-${u.color === '#3b82f6' ? 'blue' : 'red'}-500` : 'bg-white/5 border-white/5'} transition-all">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">${u.icon}</span>
                                <div>
                                    <div class="font-bold text-xs text-white">${u.id}</div>
                                    <div class="text-[9px] text-gray-400 font-mono">${u.speed} KM/H</div>
                                </div>
                            </div>
                            <div class="text-[9px] font-bold ${active ? 'text-green-400' : 'text-gray-500'}">${u.status}</div>
                        </div>
                    </div>`;
            });
        }

        function updateStep(id, isActive) {
            const el = document.getElementById(id);
            if(isActive) {
                el.classList.add('active');
                const dot = el.querySelector('.step-dot');
                dot.classList.remove('bg-slate-700'); dot.classList.add('bg-green-500', 'shadow-[0_0_10px_#22c55e]');
                const txt = el.querySelector('.step-text');
                txt.classList.remove('text-gray-500'); txt.classList.add('text-white');
            }
        }

        function switchView(view) {
            document.getElementById('view-user').classList.toggle('hidden', view !== 'user');
            document.getElementById('view-admin').classList.toggle('hidden', view !== 'admin');
            
            const btnU = document.getElementById('btn-user');
            const btnA = document.getElementById('btn-admin');
            
            if(view === 'user') {
                btnU.className = "px-5 py-2 text-xs font-bold rounded-full bg-blue-600 text-white transition-all";
                btnA.className = "px-5 py-2 text-xs font-bold rounded-full text-gray-400 hover:text-white transition-all";
            } else {
                btnU.className = "px-5 py-2 text-xs font-bold rounded-full text-gray-400 hover:text-white transition-all";
                btnA.className = "px-5 py-2 text-xs font-bold rounded-full bg-blue-600 text-white transition-all";
                map.invalidateSize();
            }
        }

        function resetSystem() { location.reload(); }

        window.onload = init;
    </script>
</body>
</html>